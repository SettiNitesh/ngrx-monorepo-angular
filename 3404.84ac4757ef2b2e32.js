(self.webpackChunkflights=self.webpackChunkflights||[]).push([[1023,3404],{1023:(He,It,ut)=>{ut.r(It),ut.d(It,{$$addStore:()=>H,$$deleteStore:()=>k,$$updateStore:()=>at,AkitaPlugin:()=>Pt,DEFAULT_ID_KEY:()=>st,DirtyCheckPlugin:()=>De,EntityActions:()=>nt,EntityCollectionPlugin:()=>Xt,EntityDirtyCheckPlugin:()=>di,EntityService:()=>Qe,EntityStateHistoryPlugin:()=>mi,EntityStore:()=>rt,EntityStoreAction:()=>Z,EntityUIQuery:()=>ke,EntityUIStore:()=>Wt,Order:()=>Dt,Paginator:()=>gi,PaginatorPlugin:()=>Yt,PersistNgFormPlugin:()=>bi,Query:()=>Jt,QueryConfig:()=>ti,QueryEntity:()=>Bt,SnapshotManager:()=>Be,StateHistoryPlugin:()=>Ve,Store:()=>zt,StoreAction:()=>Zt,StoreConfig:()=>Je,__DEV__:()=>Vt,__stores__:()=>j,action:()=>Ct,addEntities:()=>Kt,akitaConfig:()=>Q,akitaDevtools:()=>Le,applyTransaction:()=>mt,arrayAdd:()=>it,arrayFind:()=>ie,arrayRemove:()=>ne,arrayToggle:()=>c,arrayUpdate:()=>l,arrayUpsert:()=>y,byId:()=>u,byKey:()=>o,cacheable:()=>d,coerceArray:()=>U,combineQueries:()=>m,commit:()=>Ae,compareValues:()=>he,configKey:()=>ft,createEntityQuery:()=>ai,createEntityStore:()=>ri,createQuery:()=>ni,createStore:()=>si,currentAction:()=>W,dirtyCheckDefaultParams:()=>Gt,dispatchAdded:()=>re,dispatchDeleted:()=>Ot,dispatchUpdate:()=>ae,distinctUntilArrayItemChanged:()=>jt,enableAkitaProdMode:()=>qe,endBatch:()=>we,entitiesToArray:()=>le,entitiesToMap:()=>fe,filterNil:()=>Ye,filterNilValue:()=>Ce,find:()=>kt,getActiveEntities:()=>de,getAkitaConfig:()=>b,getEntityStore:()=>$e,getEntityStoreByName:()=>Ne,getExitingActives:()=>xt,getInitialEntitiesState:()=>ye,getNestedPath:()=>wt,getStore:()=>te,getStoreByName:()=>Mt,getValue:()=>vt,guid:()=>oi,hasActiveState:()=>ct,hasEntity:()=>et,isArray:()=>D,isDefined:()=>N,isDev:()=>O,isEmpty:()=>R,isEntityState:()=>me,isFunction:()=>S,isMultiActiveState:()=>Ut,isNil:()=>$,isNotBrowser:()=>Lt,isNumber:()=>ui,isObject:()=>X,isPlainObject:()=>$t,isString:()=>St,isTransactionInProcess:()=>Qt,isUndefined:()=>q,logAction:()=>M,persistState:()=>fi,queryConfigKey:()=>Nt,removeAllEntities:()=>ge,removeEntities:()=>pe,resetCustomAction:()=>bt,resetStores:()=>Si,resolveActiveEntity:()=>ht,runEntityStoreAction:()=>Pi,runStoreAction:()=>_i,selectPersistStateInit:()=>ci,setAction:()=>F,setEntities:()=>ve,setLoading:()=>wi,setLoadingAndError:()=>Ai,setSkipAction:()=>Ht,setValue:()=>Et,snapshotManager:()=>Ii,sortByOptions:()=>xe,startBatch:()=>Pe,toBoolean:()=>ot,toEntitiesIds:()=>Ti,toEntitiesObject:()=>be,trackIdChanges:()=>Ci,transaction:()=>qt,transactionManager:()=>Y,updateEntities:()=>Ie,withTransaction:()=>Xe});const W={type:null,entityIds:null,skip:!1,payload:null};let Tt=!1;function bt(){Tt=!1}function M(s,t,e){F(s,t,e),Tt=!0}function F(s,t,e){!1===Tt&&(W.type=s,W.entityIds=t,W.payload=e)}function Ht(s=!0){W.skip=s}function Ct(s,t){return function(e,i,n){const r=n.value;return n.value=function(...a){return M(s,t),r.apply(this,a)},n}}function et(s,t){return s.hasOwnProperty(t)}function D(s){return Array.isArray(s)}function ct(s){return s.hasOwnProperty("active")}function Ut(s){return D(s)}function ht({active:s,ids:t,entities:e}){return Ut(s)?xt(s,t):!1===et(e,s)?null:s}function xt(s,t){const e=s.filter(i=>t.indexOf(i)>-1);return e.length===s.length?s:e}function Kt({state:s,entities:t,idKey:e,options:i={},preAddEntity:n}){let r={},a=[],f=!1;for(const g of t)if(!1===et(s.entities,g[e])){const p=n(g),_=p[e];r[_]=p,i.prepend?a.unshift(_):a.push(_),f=!0}return f?{newState:{...s,entities:{...s.entities,...r},ids:i.prepend?[...a,...s.ids]:[...s.ids,...a]},newIds:a}:null}function $(s){return null==s}function U(s){return $(s)?[]:Array.isArray(s)?s:[s]}function it(s,t,e={}){const i=U(t),n=s||[];return e.prepend?[...i,...n]:[...n,...i]}var h=ut(4866);const st="id";function R(s){return!!D(s)&&0===s.length}function S(s){return"function"==typeof s}function kt(s,t,e){const i=[];if(S(t))for(const n of s)!0===t(n)&&i.push(n);else{const n=U(t).reduce((r,a)=>r.add(a),new Set);for(const r of s)n.has(r[e])&&i.push(r)}return i}function jt(){return(0,h.distinctUntilChanged)((s,t)=>s===t||!(!D(s)||!D(t))&&(!(!R(s)||!R(t))||s.length===t.length&&!1===t.some((i,n)=>s[n]!==i)))}function ie(s,t){return function(e){return e.pipe((0,h.map)(i=>!1===D(i)?i:kt(i,s,t||st)),jt(),(0,h.map)(i=>!1===D(i)||D(s)||S(s)?i:i[0]))}}function X(s){const t=typeof s;return null!=s&&("object"==t||"function"==t)}function ne(s,t,e=st){let i,n;if(S(t)?n=function se(s){return function(...t){return!s(...t)}}(t):(i=U(t),n=r=>!1===i.includes(X(r)?r[e]:r)),Array.isArray(s))return s.filter(n)}function o(s){return(t,e)=>t[s]===e[s]}function u(){return o("id")}function c(s,t,e=(i,n)=>i===n){const i=s.findIndex(n=>e(t,n));return~i?[...s.slice(0,i),...s.slice(i+1)]:[...s,t]}function l(s,t,e,i=st){let n;if(S(t))n=t;else{const a=U(t);n=f=>!0===a.includes(X(f)?f[i]:f)}return s.map((f,g)=>!0===n(f,g)?X(f)?{...f,...e}:e:f)}function y(s,t,e,i=st){const n=X(e);return s.some(a=>n?a[i]===t:a===t)?l(s,t,e,i):it(s,n?{...e,[i]:t}:e)}function d(s,t,e={emitNext:!1}){return s._cache().value?e.emitNext?(0,h.of)(void 0):h.EMPTY:t}function m(s){return(0,h.combineLatest)(s).pipe((0,h.auditTime)(0))}let A={resettable:!1,ttl:null,producerFn:void 0};function Q(s){A={...A,...s}}function b(){return A}function N(s){return!1===$(s)}const k=new h.Subject,H=new h.ReplaySubject(50,5e3),at=new h.Subject;function Ot(s){k.next(s)}function re(s){H.next(s)}function ae(s,t){at.next({storeName:s,action:t})}const Ft=typeof window<"u",Lt=!Ft,oe=()=>{try{return typeof localStorage<"u"}catch{return!1}},Ke=()=>{try{return typeof sessionStorage<"u"}catch{return!1}},j={},ue={};function ce(s){return s&&s.charAt(0).toUpperCase()+s.slice(1)}Ft&&(window.$$stores=j,window.$$queries=ue);let lt=[];function Le(s,t={}){if(Lt||!window.__REDUX_DEVTOOLS_EXTENSION__)return;lt.length&&lt.forEach(p=>{p.unsubscribe?p.unsubscribe():p&&p()}),s&&s.run||((s=s||{}).run=p=>p(),t=s);const n=Object.assign({},{name:"Akita",shallow:!0,storesWhitelist:[]},t),r=n.storesWhitelist,a=window.__REDUX_DEVTOOLS_EXTENSION__.connect(n);let f={};const g=p=>!r.length||r.indexOf(p)>-1;lt.push(H.subscribe(p=>{!1!==g(p)&&(f={...f,[p]:j[p]._value()},a.send({type:`[${ce(p)}] - @@INIT`},f))})),lt.push(k.subscribe(p=>{!1!==g(p)&&(delete f[p],a.send({type:`[${p}] - Delete Store`},f))})),lt.push(at.subscribe(({storeName:p,action:_})=>{if(!1===g(p))return;const{type:v,entityIds:P,skip:x,...I}=_,J=I.payload;if(x)return void Ht(!1);const L=j[p];if(!L||!1===t.shallow&&f[p]&&JSON.stringify(L._value())===JSON.stringify(f[p]))return;f={...f,[p]:L._value()};const G=ce(p);let z=N(P)?`[${G}] - ${v} (ids: ${P})`:`[${G}] - ${v}`;if(t.logTrace&&(console.group(z),console.trace(),console.groupEnd()),t.sortAlphabetically){const At=Object.keys(f).sort().reduce((dt,yt)=>(dt[yt]=f[yt],dt),{});a.send({type:z,...J},At)}else a.send({type:z,...J},f)})),lt.push(a.subscribe(p=>{if("DISPATCH"===p.type){if("COMMIT"===p.payload.type)return void a.init(f);if(p.state){const v=JSON.parse(p.state);for(let P=0,x=Object.keys(v);P<x.length;P++){const I=x[P];j[I]&&s.run(()=>{j[I]._setState(()=>v[I],!1)})}}}}))}var Dt=function(s){return s.ASC="asc",s.DESC="desc",s}(Dt||{});function he(s,t=Dt.ASC){return function(e,i){if(!e.hasOwnProperty(s)||!i.hasOwnProperty(s))return 0;const n="string"==typeof e[s]?e[s].toUpperCase():e[s],r="string"==typeof i[s]?i[s].toUpperCase():i[s];let a=0;return n>r?a=1:n<r&&(a=-1),t==Dt.DESC?-1*a:a}}function le(s,t){let e=[];const{ids:i,entities:n}=s,{filterBy:r,limitTo:a,sortBy:f,sortByOrder:g}=t;for(let _=0;_<i.length;_++){const v=n[i[_]];r?U(r).every(I=>I(v,_))&&e.push(v):e.push(v)}if(f){let _=S(f)?f:he(f,g);e=e.sort((v,P)=>_(v,P,s))}const p=Math.min(a||e.length,e.length);return p===e.length?e:e.slice(0,p)}function fe(s,t){const e={},{filterBy:i,limitTo:n}=t,{ids:r,entities:a}=s;if(!i&&!n)return a;const f=!1===$(n);if(i&&f){let g=0;for(let p=0,_=r.length;p<_&&g!==n;p++){const v=r[p],P=a[v];U(i).every(I=>I(P,p))&&(e[v]=P,g++)}}else{const g=Math.min(n||r.length,r.length);for(let p=0;p<g;p++){const _=r[p],v=a[_];i?U(i).every(x=>x(v,p))&&(e[_]=v):e[_]=v}}return e}var nt=function(s){return s.Set="Set",s.Add="Add",s.Update="Update",s.Remove="Remove",s}(nt||{});class Qe{}var K=ut(5215);let Vt=!0;function qe(){Vt=!1,Ft&&(delete window.$$stores,delete window.$$queries)}function O(){return Vt}function de(s,t,e){let i;if(D(s))i=s;else if(X(s)){if($(e))return;s=Object.assign({wrap:!0},s);const n=t.indexOf(e);if(s.prev){const r=0===n;if(r&&!s.wrap)return;i=r?t[t.length-1]:t[n-1]}else if(s.next){const r=t.length===n+1;if(r&&!s.wrap)return;i=r?t[0]:t[n+1]}}else{if(s===e)return;i=s}return i}const ye=()=>({entities:{},ids:[],loading:!0,error:null});function q(s){return void 0===s}function pe({state:s,ids:t}){if($(t))return ge(s);const e=s.entities;let i={};for(const r of s.ids)!1===t.includes(r)&&(i[r]=e[r]);const n={...s,entities:i,ids:s.ids.filter(r=>!1===t.includes(r))};return ct(s)&&(n.active=ht(n)),n}function ge(s){return{...s,entities:{},ids:[],active:Ut(s.active)?[]:null}}function be(s,t,e){const i={entities:{},ids:[]};for(const n of s){const r=e(n);i.entities[r[t]]=r,i.ids.push(r[t])}return i}function me(s){return s.entities&&s.ids}function Se(s,t){let e={};for(const i of Object.keys(s))e[i]=t(s[i]);return e}function ve({state:s,entities:t,idKey:e,preAddEntity:i,isNativePreAdd:n}){let r,a;if(D(t)){const g=be(t,e,i);r=g.entities,a=g.ids}else me(t)?(r=n?t.entities:Se(t.entities,i),a=t.ids):(r=n?t:Se(t,i),a=Object.keys(r).map(g=>isNaN(g)?g:Number(g)));const f={...s,entities:r,ids:a,loading:!1};return ct(s)&&(f.active=ht(f)),f}function Ee(s){Object.freeze(s);const t="function"==typeof s,e=Object.prototype.hasOwnProperty;return Object.getOwnPropertyNames(s).forEach(function(i){e.call(s,i)&&(!t||"caller"!==i&&"callee"!==i&&"arguments"!==i)&&null!==s[i]&&("object"==typeof s[i]||"function"==typeof s[i])&&!Object.isFrozen(s[i])&&Ee(s[i])}),s}class ze extends Error{constructor(t){super(t)}}function ot(s){return null!=s&&"false"!=`${s}`}function $t(s){return ot(s)&&"Object"===s.constructor.name}const ft="akitaConfig";function Je(s){return function(t){t[ft]={idKey:"id"};for(let e=0,i=Object.keys(s);e<i.length;e++){const n=i[e];"name"===n?t[ft].storeName=s[n]:t[ft][n]=s[n]}}}const Ge=new h.Subject,_e=new h.BehaviorSubject(!1),Y={activeTransactions:0,batchTransaction:null};function Pe(){Qt()||(Y.batchTransaction=new h.Subject),Y.activeTransactions++,_e.next(!0)}function we(){0==--Y.activeTransactions&&(Y.batchTransaction.next(!0),Y.batchTransaction.complete(),_e.next(!1),Ge.next(!0))}function Qt(){return Y.activeTransactions>0}function Ae(){return Y.batchTransaction?Y.batchTransaction.asObservable():(0,h.of)(!0)}function mt(s,t=void 0){Pe();try{return s.apply(t)}finally{M("@Transaction"),we()}}function qt(){return function(s,t,e){const i=e.value;return e.value=function(...n){return mt(()=>i.apply(this,n),this)},e}}function Xe(s){return function(t){return t.pipe((0,h.tap)(e=>mt(()=>s(e))))}}class zt{constructor(t,e={}){this.options=e,this.inTransaction=!1,this.cache={active:new h.BehaviorSubject(!1),ttl:null},this.onInit(t)}setLoading(t=!1){t!==this._value().loading&&(O()&&F("Set Loading"),this._setState(e=>({...e,loading:t})))}setHasCache(t,e={restartTTL:!1}){if(t!==this.cache.active.value&&this.cache.active.next(t),e.restartTTL){const i=this.getCacheTTL();i&&(null!==this.cache.ttl&&clearTimeout(this.cache.ttl),this.cache.ttl=setTimeout(()=>this.setHasCache(!1),i))}}getValue(){return this.storeValue}setError(t){t!==this._value().error&&(O()&&F("Set Error"),this._setState(e=>({...e,error:t})))}_select(t){return this.store.asObservable().pipe((0,h.map)(e=>t(e.state)),(0,h.distinctUntilChanged)())}_value(){return this.storeValue}_cache(){return this.cache.active}get config(){return this.constructor[ft]||{}}get storeName(){return this.config.storeName||this.options.storeName||this.options.name}get deepFreeze(){return this.config.deepFreezeFn||this.options.deepFreezeFn||Ee}get cacheConfig(){return this.config.cache||this.options.cache}get _producerFn(){return this.config.producerFn||this.options.producerFn||function V(){return A.producerFn}()}get resettable(){return N(this.config.resettable)?this.config.resettable:this.options.resettable}_setState(t,e=!0){if(S(t)){const i=t(this._value());this.storeValue=Vt?this.deepFreeze(i):i}else this.storeValue=t;if(!this.store)return this.store=new h.BehaviorSubject({state:this.storeValue}),void(O()&&this.store.subscribe(({action:i})=>{i&&ae(this.storeName,i)}));Qt()?this.handleTransaction():this.dispatch(this.storeValue,e)}reset(){this.isResettable()&&(O()&&F("Reset"),this._setState(()=>Object.assign({},this._initialState)),this.setHasCache(!1))}update(t){let e;O()&&F("Update");const i=this._value();e=S(t)?S(this._producerFn)?this._producerFn(i,t):t(i):t;const n=this.akitaPreUpdate(i,{...i,...e}),r=$t(i)?n:new i.constructor(n);this._setState(r)}updateStoreConfig(t){this.options={...this.options,...t}}akitaPreUpdate(t,e){return e}destroy(){(!Ft||!window.hmrEnabled)&&this===j[this.storeName]&&(delete j[this.storeName],Ot(this.storeName),this.setHasCache(!1),this.cache.active.complete(),this.store.complete())}onInit(t){j[this.storeName]=this,this._setState(()=>t),re(this.storeName),this.isResettable()&&(this._initialState=t),O()&&function We(s,t){s||console.error(`@StoreConfig({ name }) is missing in ${t}`)}(this.storeName,this.constructor.name)}dispatch(t,e=!0){let i;e&&(i=W,bt()),this.store.next({state:t,action:i})}watchTransaction(){Ae().subscribe(()=>{this.inTransaction=!1,this.dispatch(this._value())})}isResettable(){return!1!==this.resettable&&(this.resettable||b().resettable)}handleTransaction(){this.inTransaction||(this.watchTransaction(),this.inTransaction=!0)}getCacheTTL(){return this.cacheConfig&&this.cacheConfig.ttl||b().ttl}}function Ie({state:s,ids:t,idKey:e,newStateOrFn:i,preUpdateEntity:n,producerFn:r,onEntityIdChanges:a}){const f={};let p,g=!1;for(const P of t){if(!1===et(s.entities,P))continue;const x=s.entities[P];let I;I=S(i)?S(r)?r(x,i):i(x):i;const J=I.hasOwnProperty(e)&&I[e]!==x[e];let L;p=P,J&&(g=!0,p=I[e]);const G={...x,...I};L=$t(x)?G:$t(I)?new x.constructor(G):new I.constructor(G),f[p]=n(x,L)}let _=s.ids,v=s.entities;if(g){const[P]=t,{[P]:x,...I}=s.entities;v=I,_=s.ids.map(J=>J===P?p:J),a(P,p)}return{...s,entities:{...v,...f},ids:_}}var Te;class rt extends zt{constructor(t={},e={}){super({...ye(),...t},e),this.options=e,this.entityActions=new h.Subject,this.entityIdChanges=new h.Subject}get selectEntityAction$(){return this.entityActions.asObservable()}get selectEntityIdChanges$(){return this.entityIdChanges.asObservable()}get idKey(){return this.config.idKey||this.options.idKey||st}set(t,e={}){if($(t))return;O()&&F("Set Entity");const i=this.akitaPreAddEntity===rt.prototype.akitaPreAddEntity;this.setHasCache(!0,{restartTTL:!0}),this._setState(n=>{const r=ve({state:n,entities:t,idKey:this.idKey,preAddEntity:this.akitaPreAddEntity.bind(this),isNativePreAdd:i});return!1===q(e.activeId)&&(r.active=e.activeId),r}),this.hasInitialUIState()&&this.handleUICreation(),this.entityActions.next({type:nt.Set,ids:this.ids})}add(t,e={loading:!1}){const i=U(t);if(R(i))return;const n=Kt({state:this._value(),preAddEntity:this.akitaPreAddEntity.bind(this),entities:i,idKey:this.idKey,options:e});n&&(O()&&F("Add Entity"),n.newState.loading=e.loading,this._setState(()=>n.newState),this.hasInitialUIState()&&this.handleUICreation(!0),this.entityActions.next({type:nt.Add,ids:n.newIds}))}update(t,e){if(q(e))return void super.update(t);let n,i=[];i=S(t)?this.ids.filter(r=>t(this.entities[r])):$(t)?this.ids:U(t),R(i)||(O()&&F("Update Entity",i),this._setState(r=>Ie({idKey:this.idKey,ids:i,preUpdateEntity:this.akitaPreUpdateEntity.bind(this),state:r,newStateOrFn:e,producerFn:this._producerFn,onEntityIdChanges:(a,f)=>{n={oldId:a,newId:f},this.entityIdChanges.next({...n,pending:!0})}})),n&&this.entityIdChanges.next({...n,pending:!1}),this.entityActions.next({type:nt.Update,ids:i}))}upsert(t,e,i,n={}){const r=U(t),a=v=>P=>et(this.entities,P)===v,f=S(i)?n.baseClass:i?i.baseClass:void 0,g=S(f),p=r.filter(a(!0)),_=r.filter(a(!1)).map(v=>{const P="function"==typeof e?e({}):e,I={...S(i)?i(v,P):P,[this.idKey]:v};return g?new f(I):I});this.update(p,e),this.add(_),O()&&M("Upsert Entity")}upsertMany(t,e={}){const i=[],n=[],r={};for(const a of t){const f=this.akitaPreCheckEntity(a),g=f[this.idKey];if(et(this.entities,g)){const p=this._value().entities[g],_={...this._value().entities[g],...f},v=e.baseClass?new e.baseClass(_):_,P=this.akitaPreUpdateEntity(p,v),x=P[this.idKey];r[x]=P,n.push(x)}else{const p=e.baseClass?new e.baseClass(f):f,_=this.akitaPreAddEntity(p),v=_[this.idKey];i.push(v),r[v]=_}}O()&&M("Upsert Many"),this._setState(a=>({...a,ids:i.length?[...a.ids,...i]:a.ids,entities:{...a.entities,...r},loading:!!e.loading})),n.length&&this.entityActions.next({type:nt.Update,ids:n}),i.length&&this.entityActions.next({type:nt.Add,ids:i}),i.length&&this.hasUIStore()&&this.handleUICreation(!0)}replace(t,e){const i=U(t);if(R(i))return;const n={};for(const r of i)n[r]={...e,[this.idKey]:r};O()&&F("Replace Entity",t),this._setState(r=>({...r,entities:{...r.entities,...n}}))}move(t,e){const i=this.ids.slice();i.splice(e<0?i.length+e:e,0,i.splice(t,1)[0]),O()&&F("Move Entity"),this._setState(n=>({...n,entities:{...n.entities},ids:i}))}remove(t){if(R(this.ids))return;const e=N(t);let i=[];i=S(t)?this.ids.filter(n=>t(this.entities[n])):e?U(t):this.ids,!R(i)&&(O()&&F("Remove Entity",i),this._setState(n=>pe({state:n,ids:i})),e||this.setHasCache(!1),this.handleUIRemove(i),this.entityActions.next({type:nt.Remove,ids:i}))}updateActive(t){const e=U(this.active);O()&&F("Update Active",e),this.update(e,t)}setActive(t){const e=de(t,this.ids,this.active);void 0!==e&&(O()&&F("Set Active",e),this._setActive(e))}addActive(t){const e=U(t);R(e)||e.every(n=>this.active.indexOf(n)>-1)||(O()&&F("Add Active",t),this._setState(n=>{const r=Array.from(new Set([...n.active,...e]));return{...n,active:r}}))}removeActive(t){const e=U(t);R(e)||!e.some(n=>this.active.indexOf(n)>-1)||(O()&&F("Remove Active",t),this._setState(n=>({...n,active:Array.isArray(n.active)?n.active.filter(r=>-1===e.indexOf(r)):null})))}toggleActive(t){const e=U(t),i=a=>f=>this.active.includes(f)===a,n=e.filter(i(!0)),r=e.filter(i(!1));this.removeActive(n),this.addActive(r),O()&&M("Toggle Active")}createUIStore(t={},e={}){return this.ui=new Wt(t,{name:`UI/${this.storeName}`,idKey:this.idKey,...e}),this.ui}destroy(){super.destroy(),this.ui instanceof rt&&this.ui.destroy(),this.entityActions.complete()}akitaPreUpdateEntity(t,e){return e}akitaPreAddEntity(t){return t}akitaPreCheckEntity(t){return t}get ids(){return this._value().ids}get entities(){return this._value().entities}get active(){return this._value().active}_setActive(t){this._setState(e=>({...e,active:t}))}handleUICreation(t=!1){const e=this.ids,i=S(this.ui._akitaCreateEntityFn);let n;const r=a=>{const f=this.entities[a],g=i?this.ui._akitaCreateEntityFn(f):this.ui._akitaCreateEntityFn;return{[this.idKey]:f[this.idKey],...g}};n=t?this.ids.filter(a=>q(this.ui.entities[a])).map(r):e.map(r),t?this.ui.add(n):this.ui.set(n)}hasInitialUIState(){return this.hasUIStore()&&!1===q(this.ui._akitaCreateEntityFn)}handleUIRemove(t){this.hasUIStore()&&this.ui.remove(t)}hasUIStore(){return this.ui instanceof Wt}}(0,K.Cg)([qt(),(0,K.Sn)("design:type",Function),(0,K.Sn)("design:paramtypes",[Object,Object,Object,Object]),(0,K.Sn)("design:returntype",void 0)],rt.prototype,"upsert",null),(0,K.Cg)([qt(),(0,K.Sn)("design:type",Function),(0,K.Sn)("design:paramtypes",["function"==typeof(Te=typeof T<"u"&&T)?Te:Object]),(0,K.Sn)("design:returntype",void 0)],rt.prototype,"toggleActive",null);class Wt extends rt{constructor(t={},e={}){super(t,e)}setInitialEntityState(t){this._akitaCreateEntityFn=t}}const Ye=s=>s.pipe((0,h.filter)(t=>null!==t&&typeof t<"u"));function Ce(){return(0,h.filter)(s=>null!=s)}function St(s){return"string"==typeof s}const Nt="akitaQueryConfig";function ti(s){return function(t){t[Nt]={};for(let e=0,i=Object.keys(s);e<i.length;e++){const n=i[e];t[Nt][n]=s[n]}}}class Jt{constructor(t){this.store=t,this.__store__=t,O()&&(ue[t.storeName]=this)}select(t){let e;if(S(t))e=t;else if(St(t))e=i=>i[t];else{if(Array.isArray(t))return this.store._select(i=>i).pipe((0,h.distinctUntilChanged)(function Ze(s){return function(t,e){const i=S(s[0]);return!1===s.some(n=>i?n(t)!==n(e):t[n]!==e[n])}}(t)),(0,h.map)(i=>S(t[0])?t.map(n=>n(i)):t.reduce((n,r)=>(n[r]=i[r],n),{})));e=i=>i}return this.store._select(e)}selectLoading(){return this.select(t=>t.loading)}selectError(){return this.select(t=>t.error)}getValue(){return this.store._value()}selectHasCache(){return this.store._cache().asObservable()}getHasCache(){return this.store._cache().value}get config(){return this.constructor[Nt]}}function Ue(s,t){return function(e){const i=e[s];if(!q(i))return t?St(t)?i[t]:t(i):i}}function xe(s,t){s.sortBy=s.sortBy||t&&t.sortBy,s.sortByOrder=s.sortByOrder||t&&t.sortByOrder}class Bt extends Jt{constructor(t,e={}){super(t),this.options=e,this.__store__=t}selectAll(t={asObject:!1}){return this.select(e=>e.entities).pipe((0,h.map)(()=>this.getAll(t)))}getAll(t={asObject:!1,filterBy:void 0,limitTo:void 0}){return t.asObject?fe(this.getValue(),t):(xe(t,this.config||this.options),le(this.getValue(),t))}selectMany(t,e){return t&&t.length?this.select(i=>i.entities).pipe((0,h.map)(i=>function ii(s,t){return s.reduce((e,i,n,r)=>{const a=t(i,n,r);return void 0!==a&&e.push(a),e},[])}(t,n=>Ue(n,e)(i))),jt()):(0,h.of)([])}selectEntity(t,e){let i=t;return S(t)&&(i=function ei(s,t){for(const e of Object.keys(t))if(!0===s(t[e]))return e}(t,this.getValue().entities)),this.select(n=>n.entities).pipe((0,h.map)(Ue(i,e)),(0,h.distinctUntilChanged)())}getEntity(t){return this.getValue().entities[t]}selectActiveId(){return this.select(t=>t.active)}getActiveId(){return this.getValue().active}selectActive(t){return D(this.getActive())?this.selectActiveId().pipe((0,h.switchMap)(e=>this.selectMany(e,t))):this.selectActiveId().pipe((0,h.switchMap)(e=>this.selectEntity(e,t)))}getActive(){const t=this.getActiveId();return D(t)?t.map(e=>this.getValue().entities[e]):ot(t)?this.getEntity(t):void 0}selectCount(t){return this.select(e=>e.entities).pipe((0,h.map)(()=>this.getCount(t)))}getCount(t){return S(t)?this.getAll().filter(t).length:this.getValue().ids.length}selectLast(t){return this.selectAt(e=>e[e.length-1],t)}selectFirst(t){return this.selectAt(e=>e[0],t)}selectEntityAction(t){if($(t))return this.store.selectEntityAction$;const e=D(t)?n=>n:({ids:n})=>n,i=U(t);return this.store.selectEntityAction$.pipe((0,h.filter)(({type:n})=>i.includes(n)),(0,h.map)(n=>e(n)))}hasEntity(t){return $(t)?this.getValue().ids.length>0:S(t)?this.getAll().some(t):D(t)?t.every(e=>e in this.getValue().entities):t in this.getValue().entities}hasActive(t){const e=this.getValue().active,i=N(t);return Array.isArray(e)?i?e.includes(t):e.length>0:i?e===t:N(e)}createUIQuery(){this.ui=new ke(this.__store__.ui)}selectAt(t,e){return this.select(i=>i.ids).pipe((0,h.map)(t),(0,h.distinctUntilChanged)(),(0,h.switchMap)(i=>this.selectEntity(i,e)))}}class ke extends Bt{constructor(t){super(t)}}function si(s,t){return new zt(s,t)}function ni(s){return new Jt(s)}function ri(s,t){return new rt(s,t)}function ai(s,t={}){return new Bt(s,t)}function vt(s,t){return 1===t.split(".").length?s:t.split(".").slice(1).join(".").split(".").reduce((i,n)=>i&&i[n],s)}function oi(){return Math.random().toString(36).slice(2)}function ui(s){return!D(s)&&s-parseFloat(s)+1>=0}function Et(s,t,e,i=!1){const n=t.split(".");if(1===n.length)return{...s,...e};s={...s};const r=n.length-2;return t.split(".").slice(1).reduce((f,g,p)=>p!==r?(f[g]={...f[g]},f&&f[g]):(f[g]=i||Array.isArray(f[g])||!X(f[g])?e:{...f[g],...e},f&&f[g]),s),s}let je=!1;const Oe=new h.ReplaySubject(1);function ci(){return Oe.asObservable()}function Fe(s){je=s}function hi(){return je}function _t(s){return function li(s){return s&&S(s.then)}(s)||(0,h.isObservable)(s)?(0,h.from)(s):(0,h.of)(s)}function fi(s){const t={key:"AkitaStores",enableInNonBrowser:!1,storage:oe()?localStorage:s.storage,deserialize:JSON.parse,serialize:JSON.stringify,include:[],select:[],persistOnDestroy:!1,preStorageUpdate:function(C,w){return w},preStoreUpdate:function(C,w){return w},skipStorageUpdate:hi,preStorageUpdateOperator:()=>C=>C},{storage:e,enableInNonBrowser:i,deserialize:n,serialize:r,include:a,select:f,key:g,preStorageUpdate:p,persistOnDestroy:_,preStorageUpdateOperator:v,preStoreUpdate:P,skipStorageUpdate:x}=Object.assign({},t,s);if(Lt&&!i||!e)return;const I=a.length>0,J=f.length>0;let L,G;I&&(L=a.reduce((C,w)=>(S(w)?C.fns.push(w):C[w.split(".")[0]]=w,C),{fns:[]})),J&&(G=f.reduce((C,w)=>(C[w.storeName]=w,C),{}));let z={};const At={},dt=[],yt=[];function Me(C){_t(C).subscribe(()=>{const w=yt.shift();w&&Me(w)})}const xi=oe()&&e===localStorage||Ke()&&e===sessionStorage;return _t(e.getItem(g)).subscribe(C=>{let w=X(C)?C:n(C||"{}");function tt(E){w.$cache={...w.$cache||{},...E},w=Object.assign({},w,At),yt.push(e.setItem(g,xi?r(w):w)),Me(yt.shift())}function pt(E,gt){z[E]=j[E]._select(B=>vt(B,gt)).pipe((0,h.skip)(1),(0,h.map)(B=>J&&G[E]?G[E](B):B),(0,h.filter)(()=>!1===x()),v()).subscribe(B=>{At[E]=p(E,B),Promise.resolve().then(()=>tt({[E]:j[E]._cache().getValue()}))})}function ee(E,gt,B){E in w&&(F("@PersistState"),gt._setState(Rt=>Et(Rt,B,P(E,w[E],Rt))),j[E].setHasCache(!!w.$cache&&w.$cache[E],{restartTTL:!0}))}dt.push(k.subscribe(E=>{z[E]&&(!1===_&&tt({[E]:!1}),z[E].unsubscribe(),delete z[E])})),dt.push(H.subscribe(E=>{if("router"===E)return;const gt=j[E];if(I){let B=L[E];if(!B){if(!L.fns.some(Rt=>Rt(E)))return;B=E}ee(E,gt,B),pt(E,B)}else ee(E,gt,E),pt(E,E)})),Oe.next(!0)}),{destroy(){dt.forEach(C=>C.unsubscribe());for(let C=0,w=Object.keys(z);C<w.length;C++)z[w[C]].unsubscribe();z={}},clear(){e.clear()},clearStore(C){$(C)?_t(e.setItem(g,"{}")).subscribe():_t(e.getItem(g)).subscribe(tt=>{const pt=n(tt||"{}");pt[C]&&(delete pt[C],_t(e.setItem(g,r(pt))).subscribe())})}}}class Pt{constructor(t,e){this.query=t,e&&e.resetFn&&b().resettable&&this.onReset(e.resetFn)}getQuery(){return this.query}getStore(){return this.getQuery().__store__}isEntityBased(t){return ot(t)}selectSource(t,e){return this.isEntityBased(t)?this.getQuery().selectEntity(t).pipe(Ce()):e?this.getQuery().select(i=>vt(i,this.withStoreName(e))):this.getQuery().select()}getSource(t,e){if(this.isEntityBased(t))return this.getQuery().getEntity(t);const i=this.getQuery().getValue();return e?vt(i,this.withStoreName(e)):i}withStoreName(t){return`${this.storeName}.${t}`}get storeName(){return this.getStore().storeName}updateStore(t,e,i,n=!1){if(this.isEntityBased(e)){const r=this.getStore();n?r.replace(e,t):r.update(e,t)}else{if(i)return void this.getStore()._setState(a=>Et(a,this.withStoreName(i),t,!0));const r=n?t:a=>({...a,...t});this.getStore()._setState(r)}}onReset(t){const e=this.getStore().reset;this.getStore().reset=(...i)=>{setTimeout(()=>{e.apply(this.getStore(),i),t()})}}}const Gt={comparator:(s,t)=>JSON.stringify(s)!==JSON.stringify(t)};function wt(s,t){return t.split(".").reduce((i,n)=>i&&"undefined"!==i[n]?i[n]:void 0,s)}class De extends Pt{constructor(t,e,i){if(super(t),this.query=t,this.params=e,this._entityId=i,this.dirty=new h.BehaviorSubject(!1),this.active=!1,this._reset=new h.Subject,this.isDirty$=this.dirty.asObservable().pipe((0,h.distinctUntilChanged)()),this.reset$=this._reset.asObservable(),this.params={...Gt,...e},this.params.watchProperty){const n=U(this.params.watchProperty);t instanceof Bt&&n.includes("entities")&&!n.includes("ids")&&n.push("ids"),this.params.watchProperty=n}}reset(t={}){let e=this.head;S(t.updateFn)&&(e=this.isEntityBased(this._entityId)?t.updateFn(this.head,this.getQuery().getEntity(this._entityId)):t.updateFn(this.head,this.getQuery().getValue())),M("@DirtyCheck - Revert"),this.updateStore(e,this._entityId),this._reset.next(!0)}setHead(){return this.active?this.head=this._getHead():(this.activate(),this.active=!0),this.updateDirtiness(!1),this}isDirty(){return!!this.dirty.value}hasHead(){return!!this.getHead()}destroy(){this.head=null,this.subscription&&this.subscription.unsubscribe(),this._reset&&this._reset.complete()}isPathDirty(t){const e=this.getHead(),n=wt(this.getQuery().getValue(),t),r=wt(e,t);return this.params.comparator(n,r)}getHead(){return this.head}activate(){this.head=this._getHead();const t=this.params.watchProperty?this.params.watchProperty.map(e=>this.query.select(i=>i[e]).pipe((0,h.map)(i=>({val:i,__akitaKey:e})))):[this.selectSource(this._entityId)];this.subscription=(0,h.combineLatest)(t).pipe((0,h.skip)(1)).subscribe(e=>{if(q(this.head))return;const i=e.some(n=>this.params.comparator(n.__akitaKey?this.head[n.__akitaKey]:this.head,n.__akitaKey?n.val:n));this.updateDirtiness(i)})}updateDirtiness(t){this.dirty.next(t)}_getHead(){let t=this.getSource(this._entityId);return this.params.watchProperty&&(t=this.getWatchedValues(t)),t}getWatchedValues(t){return this.params.watchProperty.reduce((e,i)=>(e[i]=t[i],e),{})}}class Xt{constructor(t,e){this.query=t,this.entityIds=e,this.entities=new Map}getEntity(t){return this.entities.get(t)}hasEntity(t){return this.entities.has(t)}removeEntity(t){return this.destroy(t),this.entities.delete(t)}createEntity(t,e){return this.entities.set(t,e)}getIds(){return q(this.entityIds)?this.query.getValue().ids:U(this.entityIds)}resolvedIds(t){return q(t)?this.getIds():U(t)}rebase(t,e={}){if(ot(t))if(q(this.entityIds)){for(let i=0,n=t.length;i<n;i++){const r=t[i];if(!1===this.hasEntity(r)){S(e.beforeAdd)&&e.beforeAdd(r);const a=this.instantiatePlugin(r);this.entities.set(r,a),S(e.afterAdd)&&e.afterAdd(a)}}this.entities.forEach((i,n)=>{-1===t.indexOf(n)&&(S(e.beforeRemove)&&e.beforeRemove(i),this.removeEntity(n))})}else{const i=U(this.entityIds);for(let n=0,r=i.length;n<r;n++){const a=i[n];if(t.indexOf(a)>-1&&!1===this.hasEntity(a)){S(e.beforeAdd)&&e.beforeAdd(a);const f=this.instantiatePlugin(a);this.entities.set(a,f),S(e.afterAdd)&&e.afterAdd(f)}else this.entities.forEach((f,g)=>{-1===t.indexOf(g)&&!0===this.hasEntity(g)&&(S(e.beforeRemove)&&e.beforeRemove(f),this.removeEntity(g))})}}else this.getIds().forEach(i=>{this.hasEntity(i)||this.createEntity(i,this.instantiatePlugin(i))})}selectIds(){return this.query.select(t=>t.ids)}activate(t){this.rebase(t)}forEachId(t,e){const i=this.resolvedIds(t);for(let n=0,r=i.length;n<r;n++){const a=i[n];this.hasEntity(a)&&e(this.getEntity(a))}}}class di extends Xt{constructor(t,e={}){super(t,e.entityIds),this.query=t,this.params=e,this._someDirty=new h.Subject,this.someDirty$=(0,h.merge)(this.query.select(i=>i.entities),this._someDirty.asObservable()).pipe((0,h.auditTime)(0),(0,h.map)(()=>this.checkSomeDirty())),this.params={...Gt,...e},this.activate(),this.selectIds().pipe((0,h.skip)(1)).subscribe(i=>{super.rebase(i,{afterAdd:n=>n.setHead()})})}setHead(t){if(this.params.entityIds&&t){const e=U(t);if(!1===U(this.params.entityIds).some(n=>e.indexOf(n)>-1))return this}return this.forEachId(t,e=>e.setHead()),this._someDirty.next(!0),this}hasHead(t){return!!this.entities.has(t)&&this.getEntity(t).hasHead()}reset(t,e={}){this.forEachId(t,i=>i.reset(e))}isDirty(t,e=!0){if(this.entities.has(t)){const i=this.getEntity(t);return e?i.isDirty$:i.isDirty()}return!1}someDirty(){return this.checkSomeDirty()}isPathDirty(t,e){if(this.entities.has(t)){const i=this.getEntity(t).getHead(),r=wt(this.query.getEntity(t),e),a=wt(i,e);return this.params.comparator(r,a)}return null}destroy(t){this.forEachId(t,e=>e.destroy()),t||this._someDirty.complete()}instantiatePlugin(t){return new De(this.query,this.params,t)}checkSomeDirty(){const t=this.resolvedIds();for(const e of t)if(this.getEntity(e).isDirty())return!0;return!1}}const yi={pagesControls:!1,range:!1,startWith:1,cacheTimeout:void 0,clearStoreWithCache:!0};class Yt extends Pt{constructor(t,e={}){super(t,{resetFn:()=>{this.initial=!1,this.destroy({clearCache:!0,currentPage:1})}}),this.query=t,this.config=e,this.metadata=new Map,this.pages=new Map,this.pagination={currentPage:1,perPage:0,total:0,lastPage:0,data:[]},this.initial=!0,this.isLoading$=this.query.selectLoading().pipe((0,h.delay)(0)),this.config={...yi,...e};const{startWith:i,cacheTimeout:n}=this.config;this.page=new h.BehaviorSubject(i),(0,h.isObservable)(n)&&(this.clearCacheSubscription=n.subscribe(()=>this.clearCache()))}get pageChanges(){return this.page.asObservable()}get currentPage(){return this.pagination.currentPage}get isFirst(){return 1===this.currentPage}get isLast(){return this.currentPage===this.pagination.lastPage}withControls(){return this.config.pagesControls=!0,this}withRange(){return this.config.range=!0,this}setLoading(t=!0){this.getStore().setLoading(t)}update(t){this.pagination=t,this.addPage(t.data)}addPage(t){this.pages.set(this.currentPage,{ids:t.map(e=>e[this.getStore().idKey])}),this.getStore().upsertMany(t)}clearCache(t={}){this.initial||(M("@Pagination - Clear Cache"),!1!==t.clearStore&&(this.config.clearStoreWithCache||t.clearStore)&&this.getStore().remove(),this.pages=new Map,this.metadata=new Map),this.initial=!1}clearPage(t){this.pages.delete(t)}destroy({clearCache:t,currentPage:e}={}){this.clearCacheSubscription&&this.clearCacheSubscription.unsubscribe(),t&&this.clearCache(),q(e)||this.setPage(e),this.initial=!0}isPageActive(t){return this.currentPage===t}setPage(t){(t!==this.currentPage||!this.hasPage(t))&&this.page.next(this.pagination.currentPage=t)}nextPage(){this.currentPage!==this.pagination.lastPage&&this.setPage(this.pagination.currentPage+1)}prevPage(){this.pagination.currentPage>1&&this.setPage(this.pagination.currentPage-1)}setLastPage(){this.setPage(this.pagination.lastPage)}setFirstPage(){this.setPage(1)}hasPage(t){return this.pages.has(t)}getPage(t){let e=this.pagination.currentPage;return this.hasPage(e)?this.selectPage(e):(this.setLoading(!0),(0,h.from)(t()).pipe((0,h.switchMap)(i=>(e=i.currentPage,mt(()=>{this.setLoading(!1),this.update(i)}),this.selectPage(e)))))}getQuery(){return this.query}refreshCurrentPage(){!1===$(this.currentPage)&&(this.clearPage(this.currentPage),this.setPage(this.currentPage))}getFrom(){return this.isFirst?1:(this.currentPage-1)*this.pagination.perPage+1}getTo(){return this.isLast?this.pagination.total:this.currentPage*this.pagination.perPage}selectPage(t){return this.query.selectAll({asObject:!0}).pipe((0,h.take)(1),(0,h.map)(e=>{const i={...this.pagination,data:this.pages.get(t).ids.map(a=>e[a])},{range:n,pagesControls:r}=this.config;return isNaN(this.pagination.total)&&(i.total=1===i.lastPage?i.data?i.data.length:0:i.perPage*i.lastPage,this.pagination.total=i.total),n&&(i.from=this.getFrom(),i.to=this.getTo()),r&&(i.pageControls=function pi(s,t){const e=Math.ceil(s/t),i=[];for(let n=0;n<e;n++)i.push(n+1);return i}(this.pagination.total,this.pagination.perPage)),i}))}}(0,K.Cg)([Ct("@Pagination - New Page"),(0,K.Sn)("design:type",Function),(0,K.Sn)("design:paramtypes",[Object]),(0,K.Sn)("design:returntype",void 0)],Yt.prototype,"update",null);const gi=Yt;class bi extends Pt{constructor(t,e,i={}){super(t),this.query=t,this.factoryFnOrPath=e,this.params=i,this.params={debounceTime:300,formKey:"akitaForm",emitEvent:!1,arrControlFactory:n=>this.builder.control(n),...i},this.isRootKeys=!1===ot(e),this.isKeyBased=St(e)||this.isRootKeys}setForm(t,e){return this.form=t,this.builder=e,this.activate(),this}reset(t){let e;e=t||(this.isKeyBased?this.initialValue:this.factoryFnOrPath()),this.isKeyBased&&Object.keys(this.initialValue).forEach(n=>{const r=this.initialValue[n];Array.isArray(r)&&this.builder&&(this.cleanArray(this.form.controls[n]),r.forEach((f,g)=>{this.form.get(n).insert(g,this.params.arrControlFactory(f))}))}),this.form.patchValue(e,{emitEvent:this.params.emitEvent});const i=this.isKeyBased?Et(this.getQuery().getValue(),`${this.getStore().storeName}.${this.factoryFnOrPath}`,e):{[this.params.formKey]:e};this.updateStore(i)}cleanArray(t){for(;0!==t.length;)t.removeAt(0)}resolveInitialValue(t,e){if(t)return Object.keys(t).reduce((i,n)=>{const r=e[n];if(Array.isArray(r)&&this.builder){const a=this.params.arrControlFactory;this.cleanArray(this.form.get(n)),r.forEach((f,g)=>{this.form.get(n).insert(g,a(f))})}return i[n]=e[n],i},{})}activate(){let t;if(this.isKeyBased)if(this.isRootKeys)this.initialValue=this.resolveInitialValue(this.form.value,this.getQuery().getValue()),this.form.patchValue(this.initialValue,{emitEvent:this.params.emitEvent});else{t=`${this.getStore().storeName}.${this.factoryFnOrPath}`;const e=vt(this.getQuery().getValue(),t);this.initialValue=this.resolveInitialValue(e,e),this.form.patchValue(this.initialValue,{emitEvent:this.params.emitEvent})}else{this.getQuery().getValue()[this.params.formKey]||(M("@PersistNgFormPlugin activate"),this.updateStore({[this.params.formKey]:this.factoryFnOrPath()}));const e=this.getQuery().getValue()[this.params.formKey];this.form.patchValue(e)}this.formChanges=this.form.valueChanges.pipe((0,h.debounceTime)(this.params.debounceTime)).subscribe(e=>{let i;M("@PersistForm - Update"),i=this.isKeyBased?this.isRootKeys?n=>({...n,...e}):n=>Et(n,t,e):()=>({[this.params.formKey]:e}),this.updateStore(i(this.getQuery().getValue()))})}destroy(){this.formChanges&&this.formChanges.unsubscribe(),this.form=null,this.builder=null}}class Ve extends Pt{constructor(t,e={},i){super(t,{resetFn:()=>this.clear()}),this.query=t,this.params=e,this._entityId=i,this.skip=!1,this.history={past:[],present:null,future:[]},this.skipUpdate=!1,e.maxAge=e.maxAge?e.maxAge:10,e.comparator=e.comparator||(()=>!0),this.activate()}get hasPast$(){return this._hasPast$}get hasFuture$(){return this._hasFuture$}get hasPast(){return this.history.past.length>0}get hasFuture(){return this.history.future.length>0}get property(){return this.params.watchProperty}updateHasHistory(){this.hasFutureSubject.next(this.hasFuture),this.hasPastSubject.next(this.hasPast)}activate(){this.hasPastSubject=new h.BehaviorSubject(!1),this._hasPast$=this.hasPastSubject.asObservable().pipe((0,h.distinctUntilChanged)()),this.hasFutureSubject=new h.BehaviorSubject(!1),this._hasFuture$=this.hasFutureSubject.asObservable().pipe((0,h.distinctUntilChanged)()),this.history.present=this.getSource(this._entityId,this.property),this.subscription=this.selectSource(this._entityId,this.property).pipe((0,h.pairwise)()).subscribe(([t,e])=>{if(this.skip)return void(this.skip=!1);const i=this.params.comparator(t,e);!this.skipUpdate&&i&&(this.history.past.length===this.params.maxAge&&(this.history.past=this.history.past.slice(1)),this.history.past=[...this.history.past,t],this.history.present=e,this.updateHasHistory())})}undo(){if(this.history.past.length>0){const{past:t,present:e}=this.history,i=t[t.length-1];this.history.past=t.slice(0,t.length-1),this.history.present=i,this.history.future=[e,...this.history.future],this.update()}}redo(){if(this.history.future.length>0){const{past:t,present:e}=this.history,i=this.history.future[0],n=this.history.future.slice(1);this.history.past=[...t,e],this.history.present=i,this.history.future=n,this.update("Redo")}}jumpToPast(t){if(t<0||t>=this.history.past.length)return;const{past:e,future:i,present:n}=this.history,r=e.slice(0,t),a=[...e.slice(t+1),n,...i],f=e[t];this.history.past=r,this.history.present=f,this.history.future=a,this.update()}jumpToFuture(t){if(t<0||t>=this.history.future.length)return;const{past:e,future:i,present:n}=this.history,r=[...e,n,...i.slice(0,t)],a=i[t],f=i.slice(t+1);this.history.past=r,this.history.present=a,this.history.future=f,this.update("Redo")}jump(t){return t>0?this.jumpToFuture(t-1):t<0?this.jumpToPast(this.history.past.length+t):void 0}clear(t){this.history=S(t)?t(this.history):{past:[],present:null,future:[]},this.updateHasHistory()}destroy(t=!1){t&&this.clear(),this.subscription.unsubscribe()}ignoreNext(){this.skip=!0}update(t="Undo"){this.skipUpdate=!0,M(`@StateHistory - ${t}`),this.updateStore(this.history.present,this._entityId,this.property,!0),this.updateHasHistory(),this.skipUpdate=!1}}class mi extends Xt{constructor(t,e={}){super(t,e.entityIds),this.query=t,this.params=e,e.maxAge=ot(e.maxAge)?e.maxAge:10,this.activate(),this.selectIds().pipe((0,h.skip)(1)).subscribe(i=>this.activate(i))}redo(t){this.forEachId(t,e=>e.redo())}undo(t){this.forEachId(t,e=>e.undo())}hasPast(t){if(this.hasEntity(t))return this.getEntity(t).hasPast}hasFuture(t){if(this.hasEntity(t))return this.getEntity(t).hasFuture}jumpToFuture(t,e){this.forEachId(t,i=>i.jumpToFuture(e))}jumpToPast(t,e){this.forEachId(t,i=>i.jumpToPast(e))}clear(t,e){this.forEachId(t,i=>i.clear(e))}destroy(t,e=!1){this.forEachId(t,i=>i.destroy(e))}ignoreNext(t){this.forEachId(t,e=>e.ignoreNext())}instantiatePlugin(t){return new Ve(this.query,this.params,t)}}function Si(s){s=Object.assign({},{exclude:[]},s);const e=Object.keys(j);mt(()=>{for(const i of e){const n=j[i];s.exclude?-1===s.exclude.indexOf(n.storeName)&&n.reset():n.reset()}})}var Zt=function(s){return s.Update="UPDATE",s}(Zt||{});const vi={[Zt.Update]:"update"};var Z=function(s){return s.Update="UPDATE",s.AddEntities="ADD_ENTITIES",s.SetEntities="SET_ENTITIES",s.UpdateEntities="UPDATE_ENTITIES",s.RemoveEntities="REMOVE_ENTITIES",s.UpsertEntities="UPSERT_ENTITIES",s.UpsertManyEntities="UPSERT_MANY_ENTITIES",s}(Z||{});const Ei={[Z.Update]:"update",[Z.AddEntities]:"add",[Z.SetEntities]:"set",[Z.UpdateEntities]:"update",[Z.RemoveEntities]:"remove",[Z.UpsertEntities]:"upsert",[Z.UpsertManyEntities]:"upsertMany"};function te(s){return Mt(s[ft].storeName)}function Mt(s){const t=j[s];if($(t))throw new ze(`${t.storeName} doesn't exist`);return t}function $e(s){return te(s)}function Ne(s){return Mt(s)}function _i(s,t,e){const i="string"==typeof s?Mt(s):te(s);e(i[vi[t]].bind(i))}function Pi(s,t,e){const i="string"==typeof s?Ne(s):$e(s);e(i[Ei[t]].bind(i))}function wi(s){return function(t){return(0,h.defer)(()=>(s.setLoading(!0),t.pipe((0,h.finalize)(()=>s.setLoading(!1)))))}}function Ai(s){return function(t){return(0,h.defer)(()=>(s.setLoading(!0),s.setError(null),t.pipe((0,h.tap)({error(e){s.setLoading(!1),s.setError(e)},complete(){s.setLoading(!1)}}))))}}class Be{getStoresSnapshot(t=[]){const e={},n=t.length>0?t:Object.keys(j);for(let r=0;r<n.length;r++){const a=n[r];"router"!==a&&(e[a]=j[a]._value())}return e}setStoresSnapshot(t,e){const i={skipStorageUpdate:!1,lazy:!1,...e};i.skipStorageUpdate&&Fe(!0);let n=t;St(t)&&(n=JSON.parse(n));const r=Object.keys(n).length;if(i.lazy)H.pipe((0,h.filter)(a=>n.hasOwnProperty(a)),(0,h.take)(r)).subscribe(a=>j[a]._setState(()=>n[a]));else for(let a=0,f=Object.keys(n);a<f.length;a++){const g=f[a];j[g]&&j[g]._setState(()=>n[g])}i.skipStorageUpdate&&Fe(!1)}}const Ii=new Be;function Ti(s,t=st){const e=[];for(const i of s)e.push(i[t]);return e}function Ci(s){return t=>t.lift(new Ui(s))}class Ui{constructor(t){this.query=t}call(t,e){return e.pipe((0,h.first)(),(0,h.switchMap)(i=>{let n=i[this.query.__store__.config.idKey],r=!1;return(0,h.merge)((0,h.of)({newId:void 0,oldId:n,pending:!1}),this.query.__store__.selectEntityIdChanges$).pipe((0,h.filter)(a=>a.oldId===n),(0,h.tap)(a=>r=a.pending),(0,h.filter)(a=>a.newId!==n&&!r),(0,h.switchMap)(a=>this.query.selectEntity(n=a.newId||n).pipe((0,h.filter)(()=>!r))))})).subscribe(t)}}},5215:(He,It,ut)=>{function F(o,u,c,l){var m,y=arguments.length,d=y<3?u:null===l?l=Object.getOwnPropertyDescriptor(u,c):l;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)d=Reflect.decorate(o,u,c,l);else for(var A=o.length-1;A>=0;A--)(m=o[A])&&(d=(y<3?m(d):y>3?m(u,c,d):m(u,c))||d);return y>3&&d&&Object.defineProperty(u,c,d),d}function Ct(o,u){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(o,u)}function et(o,u,c,l){return new(c||(c=Promise))(function(d,m){function A(V){try{b(l.next(V))}catch(N){m(N)}}function Q(V){try{b(l.throw(V))}catch(N){m(N)}}function b(V){V.done?d(V.value):function y(d){return d instanceof c?d:new c(function(m){m(d)})}(V.value).then(A,Q)}b((l=l.apply(o,u||[])).next())})}function it(o){return this instanceof it?(this.v=o,this):new it(o)}function h(o,u,c){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var y,l=c.apply(o,u||[]),d=[];return y={},m("next"),m("throw"),m("return"),y[Symbol.asyncIterator]=function(){return this},y;function m(k){l[k]&&(y[k]=function(H){return new Promise(function(at,Ot){d.push([k,H,at,Ot])>1||A(k,H)})})}function A(k,H){try{!function Q(k){k.value instanceof it?Promise.resolve(k.value.v).then(b,V):N(d[0][2],k)}(l[k](H))}catch(at){N(d[0][3],at)}}function b(k){A("next",k)}function V(k){A("throw",k)}function N(k,H){k(H),d.shift(),d.length&&A(d[0][0],d[0][1])}}function R(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,u=o[Symbol.asyncIterator];return u?u.call(o):(o=function ht(o){var u="function"==typeof Symbol&&Symbol.iterator,c=u&&o[u],l=0;if(c)return c.call(o);if(o&&"number"==typeof o.length)return{next:function(){return o&&l>=o.length&&(o=void 0),{value:o&&o[l++],done:!o}}};throw new TypeError(u?"Object is not iterable.":"Symbol.iterator is not defined.")}(o),c={},l("next"),l("throw"),l("return"),c[Symbol.asyncIterator]=function(){return this},c);function l(d){c[d]=o[d]&&function(m){return new Promise(function(A,Q){!function y(d,m,A,Q){Promise.resolve(Q).then(function(b){d({value:b,done:A})},m)}(A,Q,(m=o[d](m)).done,m.value)})}}}ut.d(It,{AQ:()=>h,Cg:()=>F,N3:()=>it,Sn:()=>Ct,sH:()=>et,xN:()=>R})}}]);